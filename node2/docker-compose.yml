# Node 2 - Ray Worker (same image as Node 1)

services:
  ray-worker:
    build:
      context: .
      dockerfile: Dockerfile
    image: ray-vllm:local
    container_name: ray-worker
    hostname: ray-worker
    network_mode: host
    ipc: host
    restart: unless-stopped
    runtime: nvidia
    user: root
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - RAY_HEAD_IP=${RAY_HEAD_IP:-10.15.105.105}
    volumes:
      - ./models:/models
      - ./data:/data
      - ${MODEL_CACHE_DIR:-./models}:/root/.cache/huggingface
    command: >
      ray start
      --address=${RAY_HEAD_IP}:6379
      --num-gpus=2
      --block
    shm_size: 10gb
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
